---
title: "Data Analysis Project - How to Increase your Overwatch Skill Rating"
author: "Brian Deignan (deignan3) & Kai Chang (kaihc2)"
date: 'July 29, 2019'
output:
  html_document: 
    toc: yes
    fig_width: 10
  pdf_document: default
urlcolor: cyan
---

![Overwatch heroes Lucio, Wrecking Ball and Soldier 76 in action](ow6.jpg)

***

## Explaining the Overwatch Skill Rating

### Introduction
Our dataset consists of information on competitive gamers who play the video game Overwatch on Playstation 4. [Overwatch](https://en.wikipedia.org/wiki/Overwatch_(video_game)) is a team-based multiplayer first-person shooter developed and published by Blizzard Entertainment. Overwatch assigns players into two teams of six, with each player selecting from a roster of 30 characters, known as "heroes", each with a unique style of play whose roles are divided into three general categories that fit their role. Players on a team work together to secure and defend control points on a map or escort a payload across the map in a limited amount of time. 

Overwatch has a large community and E-Sports presence online. Players' skill in competitive games is calculated by a "secret" formula at Blizzard that leads to a "skill rating", or "SR" for short. SR ranges from 0 to 5,000, the higher the score the better the player.

Among the community, SR is divided into categories depending on how high the rating is, ranging from Bronze to Grandmaster:

- 500-1499 Bronze
- 1500-1999 Silver
- 2000-2499 Gold
- 2500-2999 Platinum
- 3000-3499 Diamond
- 3500-3999 Master
- 4000-5000 Grandmaster

##### Data

We scraped a snapshot of PS4 players' SR (it changes from game to game) whose profiles were public on overwatchtracker.com. We then scraped players' career statistics from the games that they've played from the open source API ovrstat.com which returns convenient JSON formatted data.

Currently we have over two thousand player skill ratings and over two thousand predictor variables. However, our research question will allow us to tailor our question to a small subset of the predictors, around 60 or so.

##### Research Question

Overall we're interested in the question: if a player wants to improve their SR, what should they focus on? Should they try to eliminate more opponents? Heal their teammates? Or, play a certain character? Answers like these will be provided by a predictive model of SR using career player statistics as predictors. The answers we find will allow any player to most efficiently improve their SR and begin climbing their way to Grandmaster!

The answers we find could be used by amateurs and pro Overwatch gamers alike. We think of our analysis as the start of something like ["Moneyball"](https://en.wikipedia.org/wiki/Moneyball) for Overwatch.

### Methods
```{r, echo=FALSE, message=FALSE}
library(tidyverse)
library(lmtest)
```

```{r, message=FALSE}
df = read_csv('data/clean-data.csv')
```

- relevel top hero - brian

```{r, echo=FALSE, message=FALSE}
df = df %>% 
  select(-c(game.gamesPlayed, game.timePlayed, rank)) %>% 
  mutate(top_hero = relevel(top_hero %>% as.factor(), ref='reinhardt'))
```


- glimpse - kai
```{r}
df %>% glimpse()
```

- summary - kai

- bar chart of top players - brian

##### Most played heroes

```{r, echo=FALSE, cache=TRUE}
df %>% group_by(top_hero_type, top_hero) %>% summarise(n = n()) %>% 
  ggplot(., aes(y=n, x=reorder(top_hero, n), fill=top_hero_type)) + 
  geom_bar(stat = "identity") +
  coord_flip() +
  theme_minimal() +
  labs(x='Hero', y='Number of players', title='Most popular heroes to play',
       fill = 'Hero type') +
  scale_fill_manual(values = c("#999999", "#E69F00", "#56B4E9"))
```

birefly mention hero types and what heros are: https://en.wikipedia.org/wiki/Characters_of_Overwatch#Characters

```{r}
# borrowed from week 8 HW
diagnostics <- function(model,
                        pcol = 'grey',
                        lcol = 'dodgerblue',
                        alpha = 0.05,
                        plotit = TRUE,
                        testit = TRUE
                        ){
  if (plotit){
    par(mfrow=c(1,2))
    # plot 1 - fitted vs resid
    plot(fitted(model), resid(model), col = pcol, pch = 20,
         xlab = "Fitted", ylab = "Residuals", main = "Residual versus fitted plot")
    abline(h = 0, col = lcol, lwd = 2)
    
    # plot 2
    qqnorm(resid(model), main = "Normal Q-Q Plot", col = pcol)
    qqline(resid(model), col = lcol, lwd = 2)
  }
  
  if (testit){
    st <- shapiro.test(resid(model))
    decision <- ifelse(st$p.value < 0.05, 'Reject', 'Fail to Reject')
    return(list(p_val=st$p.value, decision=decision))
  }
}
```


- full additive model without redundant variables - brian

```{r, cache=TRUE}
df %>% summary
fit_add_full = lm(skill_rating ~ . -top_hero_type, data = df)

diagnostics(fit_add_full, testit = FALSE)
```

- fail shapiro test, show qq plot - brian

```{r}
fm_diag = diagnostics(fit_add_full, plotit = FALSE)
 # TO DO WRITE OUT TEST RESUTS OF SHAPIRO WILK
fm_bp = bptest(fit_add_full)
 # TO DO WRITE OUT TEST RESUTS OF BP
fm_bp
```

##### Full additive model problems

There are two major problems in the full additive model: heteroskedasticity and non-normal residuals. We can try to find the correct model and apply transformations to the predictors. Or, what we'll do instead is think more carefully about the predictors and hand-pick a smaller model to start with based on exploratory data analysis and our knowledge of Overwatch.

- pairs plots response ~ 5 predictors - kai

- correlation - brian

- log(gp) - brian

- step bic + aic - kai

- show r^2 - kai

- 2 anova tests - kai




```{r}
library(readr)

clean_df <- read_csv("data/clean-data.csv")
predictors = colnames(clean_df)[1:60]
predictors = append(predictors, "games_played")
```

```{r}
for (name in predictors) {
  plot(as.formula(paste("skill_rating ~ ", paste(name))), data = clean_df)
}
```

```{r}

```




### Results

- diagnostics of final model - brian

- 2 anova tests - kai


### Discussion

So, what should a player who wants to improve their skill rating focus on?

- coef plot - brian
- coefficients interpretation - brian, kai



### Appendix

